language: c
sudo: false

env:
  global:
    - EDM_FULL=1.11.0
    - EDM_X_Y=1.11

cache:
  directories:
      - "$HOME/.cache"
      - "$HOME/.ccache"

matrix:
  include:
  - os: linux
    env: EDM_OS="rh5_x86_64"
    env: EDM_INSTALLER_SUFF="_linux_x86_64.sh"
  - os: osx
    env: EDM_OS="osx_x86_64"
    env: EDM_INSTALLER_SUFFIX=".pkg"

before_install:
    - ccache -s
    - export PATH=/usr/lib/ccache:${PATH}
    - wget https://package-data.enthought.com/edm/${EDM_OS}/${EDM_X_Y}/edm_${EDM_FULL}${EDM_INSTALLER_SUFFIX}
    - if [[ ${TRAVIS_OS_NAME} == "linux" ]] ; then bash ./edm_${EDM_FULL}${EDM_INSTALLER_SUFFIX} -b -f -p $HOME ; fi
    - if [[ ${TRAVIS_OS_NAME} == "osx" ]] ; then sudo installer -pkg ./edm_${EDM_FULL}${EDM_INSTALLER_SUFFIX} -target / ; fi
    - if [[ ${TRAVIS_OS_NAME} == "linux" ]] ; then export PATH=${HOME}/edm/bin:${PATH} ; fi
    - if [[ ${TRAVIS_OS_NAME} == "osx" ]]; then export PATH="${PATH}:/usr/local/bin" ; fi
    - edm install --version 3.5 -y click setuptools
    - edm run -- python -m ci build-env
script:
    - edm run -- python -m ci install
    - edm run -- python -m ci flake8
    - edm run -- python -m ci test
    - edm run -- python -m ci docs
after_success:
    - edm run -- python -m ci coverage
    - edm run -- pip install codecov
    - edm run -- codecov
    - if [[ ${TRAVIS_OS_NAME} == "linux" ]] ; then bash <(curl -s https://codecov.io/bash); fi
